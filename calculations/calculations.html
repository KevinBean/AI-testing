<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Advanced Calculations System</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <!-- jQuery UI CSS -->
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <!-- CodeMirror for code editing -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/eclipse.min.css">
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <!-- Math.js for mathematical operations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
  <!-- Chart.js for visualization -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <!-- Custom CSS -->
  <link rel="stylesheet" href="calculations-style.css">
</head>
<body>
  <div class="container-fluid">
    <h4>Advanced Calculations System</h4>

    <!-- Navigation Tabs -->
    <ul class="nav nav-tabs sticky-top bg-white" id="viewTabs" role="tablist" style="z-index: 1030;">
      <li class="nav-item">
        <a class="nav-link active" id="calculations-tab" data-toggle="tab" href="#calculationsView" role="tab">Calculations</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="functions-tab" data-toggle="tab" href="#functionsView" role="tab">Functions</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="variables-tab" data-toggle="tab" href="#variablesView" role="tab">Variables</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="settings-tab" data-toggle="tab" href="#settingsView" role="tab">Settings</a>
      </li>
    </ul>

    <div class="tab-content mt-3">
      <!-- Calculations View -->
      <div class="tab-pane fade show active" id="calculationsView" role="tabpanel">
        <div class="row">
          <!-- Sidebar with calculation list -->
          <div class="col-md-3 sidebar">
            <div class="mb-3">
              <button id="addCalculationBtn" class="btn btn-primary btn-block">Add New Calculation</button>
            </div>
            <div class="mb-3">
              <input type="text" id="calculationSearch" class="form-control" placeholder="Search calculations...">
            </div>
            
            <div class="card">
              <div class="card-header">
                <strong>Saved Calculations</strong>
              </div>
              <div class="list-group list-group-flush" id="calculationList">
                <!-- Calculation items will be dynamically added here -->
              </div>
            </div>
          </div>
          
          <!-- Main calculation area -->
          <div class="col-md-9 main-content">
            <div id="calculationEditor">
              <!-- Empty state -->
              <div id="emptyCalculationState">
                <div class="card">
                  <div class="card-body text-center">
                    <h5 class="card-title">No Calculation Selected</h5>
                    <p class="card-text">Select a calculation from the list or create a new one to get started.</p>
                    <button id="startNewCalculationBtn" class="btn btn-primary">
                      <i class="fas fa-plus-circle"></i> Create New Calculation
                    </button>
                  </div>
                </div>
              </div>
              
              <!-- Calculation edit form - initially hidden -->
              <div id="calculationForm" style="display: none;">
                <div class="card">
                  <div class="card-header">
                    <ul class="nav nav-tabs card-header-tabs" id="calculationTabs" role="tablist">
                      <li class="nav-item">
                        <a class="nav-link active" id="basic-tab" data-toggle="tab" href="#basicSettings" role="tab">Basic</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" id="parameters-tab" data-toggle="tab" href="#parametersSettings" role="tab">Parameters</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" id="logic-tab" data-toggle="tab" href="#logicSettings" role="tab">Calculation</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" id="results-tab" data-toggle="tab" href="#resultsSettings" role="tab">Results</a>
                      </li>
                    </ul>
                  </div>
                  <div class="card-body">
                    <div class="tab-content">
                      <!-- Basic Settings Tab -->
                      <div class="tab-pane fade show active" id="basicSettings" role="tabpanel">
                        <div class="form-group">
                          <label for="calculationTitle">Title <span class="text-danger">*</span></label>
                          <input type="text" class="form-control" id="calculationTitle" placeholder="Enter calculation title" required>
                        </div>
                        <div class="form-group">
                          <label for="calculationDesc">Description</label>
                          <textarea class="form-control" id="calculationDesc" rows="3" placeholder="Enter calculation description"></textarea>
                        </div>
                        <div class="form-group">
                          <label for="calculationTags">Tags</label>
                          <input type="text" class="form-control" id="calculationTags" placeholder="comma, separated, tags">
                          <small class="form-text text-muted">Separate tags with commas</small>
                        </div>
                        <div class="form-group">
                          <label for="calculationType">Calculation Type <span class="text-danger">*</span></label>
                          <select class="form-control" id="calculationType">
                            <option value="standard">Standard Expression</option>
                            <option value="custom-js">Custom JavaScript</option>
                            <option value="custom-py">Custom Python (Brython)</option>
                          </select>
                          <small class="form-text text-muted">
                            <strong>Standard Expression:</strong> Simple mathematical expressions<br>
                            <strong>Custom JavaScript:</strong> Complex calculations using JavaScript<br>
                            <strong>Custom Python:</strong> Use Python syntax (requires Brython enabled)
                          </small>
                        </div>
                        
                        <div class="form-group">
                          <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="isPublic">
                            <label class="custom-control-label" for="isPublic">Make this calculation available to other calculations</label>
                          </div>
                        </div>
                      </div>
                      
                      <!-- Parameters Tab -->
                      <div class="tab-pane fade" id="parametersSettings" role="tabpanel">
                        <div class="param-toolbar">
                          <button id="addParamBtn" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-plus"></i> Add Parameter
                          </button>
                          <button id="addParamGroupBtn" class="btn btn-sm btn-outline-secondary ml-2">
                            <i class="fas fa-folder-plus"></i> Add Group
                          </button>
                          <button id="aiSuggestParamsBtn" class="btn btn-sm btn-outline-info ml-2">
                            <i class="fas fa-robot"></i> AI Suggest Parameters
                          </button>
                        </div>
                        
                        <div id="aiParamSuggestions" class="ai-suggestion mt-2 mb-3" style="display: none;">
                          <div id="aiThinking" class="ai-thinking">
                            <i class="fas fa-spinner fa-spin"></i> Analyzing calculation and suggesting parameters...
                          </div>
                          <div id="aiSuggestions" style="display: none;"></div>
                        </div>
                        
                        <div id="parametersContainer" class="sortable mt-3">
                          <!-- Parameters will be added here -->
                          <div class="text-muted text-center py-4" id="noParametersMessage">
                            <i class="fas fa-arrow-up"></i> Click "Add Parameter" to get started
                          </div>
                        </div>
                      </div>
                      
                      <!-- Logic Tab -->
                      <div class="tab-pane fade" id="logicSettings" role="tabpanel">
                        <div class="calculation-type-container" id="standardCalculation">
                          <div class="form-group">
                            <label for="equationInput">Equation <span class="text-danger">*</span></label>
                            <div class="input-group mb-3">
                              <input type="text" class="form-control" id="equationInput" placeholder="Enter calculation formula (e.g., a + b * c)">
                              <div class="input-group-append">
                                <button class="btn btn-outline-secondary" type="button" id="browseVariablesBtn">
                                  <i class="fas fa-search"></i> Variables
                                </button>
                                <button class="btn btn-outline-secondary" type="button" id="insertFunctionBtn">
                                  <i class="fas fa-function"></i> Functions
                                </button>
                              </div>
                            </div>
                            <small class="form-text text-muted">
                              Use parameter names in your formula. Available operators: +, -, *, /, ^, (, ), sqrt(), sin(), cos(), etc.
                            </small>
                          </div>
                        </div>
                        
                        <div class="calculation-type-container" id="customJsCalculation" style="display: none;">
                          <div class="form-group">
                            <label for="customJsEditor">Custom JavaScript Code <span class="text-danger">*</span></label>
                            <div id="customJsEditor" class="code-editor"></div>
                            <small class="form-text text-muted mt-2">
                              Access parameters by name. Return your result with <code>return</code> statement.
                              <a href="#" class="text-info" id="showJsExampleBtn">Show example</a>
                            </small>
                            <div class="bg-light p-3 mt-2 border rounded" id="jsExampleCode" style="display: none;">
                              <pre><code>// Access parameters by their names
                const radius = r;
                const height = h;
                
                // Perform calculations
                const volume = Math.PI * radius * radius * height;
                const surfaceArea = 2 * Math.PI * radius * (radius + height);
                
                // Return a single value or an object with multiple results
                return {
                  volume: volume,
                  surfaceArea: surfaceArea
                };</code></pre>
                            </div>
                          </div>
                        </div>
                        
                        <div class="calculation-type-container" id="customPyCalculation" style="display: none;">
                          <div class="form-group">
                            <label for="customPyEditor">Python Code <span class="text-danger">*</span></label>
                            <div id="customPyEditor" class="code-editor"></div>
                            <small class="form-text text-muted mt-2">
                              Access parameters by name. Return your result as the last expression or with a <code>return</code> statement.
                              <a href="#" class="text-info" id="showPyExampleBtn">Show example</a>
                            </small>
                            <div class="bg-light p-3 mt-2 border rounded" id="pyExampleCode" style="display: none;">
                              <pre><code>import math
                
                # Access parameters by their names
                radius = r  
                height = h
                
                # Perform calculations
                volume = math.pi * radius**2 * height
                surface_area = 2 * math.pi * radius * (radius + height)
                
                # Return a single value or a dictionary with multiple results
                return {
                  "volume": volume,
                  "surface_area": surface_area
                }</code></pre>
                            </div>
                          </div>
                        </div>
                        
                        <div class="form-group mt-4">
                          <label>Dependencies</label>
                          <div id="dependenciesContainer" class="border rounded p-3 bg-light">
                            <p class="text-muted mb-0">No dependencies detected</p>
                          </div>
                        </div>
                        
                        <div class="form-group mt-3">
                          <button type="button" id="testCalculationBtn" class="btn btn-outline-primary">
                            <i class="fas fa-calculator"></i> Test Calculation
                          </button>
                          <button type="button" id="aiHelpBtn" class="btn btn-outline-info ml-2">
                            <i class="fas fa-robot"></i> AI Assistance
                          </button>
                        </div>
                        
                        <div id="testResultContainer" class="mt-3" style="display: none;">
                          <!-- Test results will appear here -->
                        </div>
                        
                        <div id="aiSuggestionContainer" class="ai-suggestion mt-3" style="display: none;">
                          <div id="aiThinkingLogic" class="ai-thinking">
                            <i class="fas fa-spinner fa-spin"></i> Analyzing your calculation...
                          </div>
                          <div id="aiSuggestion" style="display: none;"></div>
                        </div>
                      </div>
                      
                      <!-- Results Tab -->
                      <div class="tab-pane fade" id="resultsSettings" role="tabpanel">
                        <div class="form-group">
                          <label for="resultFormat">Result Format</label>
                          <select class="form-control" id="resultFormat">
                            <option value="auto">Auto-detect (recommended)</option>
                            <option value="number">Number</option>
                            <option value="text">Text</option>
                            <option value="boolean">Boolean</option>
                            <option value="array">Array</option>
                            <option value="object">Object/Multiple Values</option>
                          </select>
                        </div>
                        
                        <div id="numberFormatOptions">
                          <div class="form-group">
                            <label for="decimalPlaces">Decimal Places</label>
                            <input type="number" class="form-control" id="decimalPlaces" min="0" max="15" value="2">
                          </div>
                          
                          <div class="form-group">
                            <label for="numberFormat">Number Format</label>
                            <select class="form-control" id="numberFormat">
                              <option value="decimal">Decimal (1,234.56)</option>
                              <option value="scientific">Scientific (1.23e+3)</option>
                              <option value="engineering">Engineering (1.23E+3)</option>
                              <option value="percent">Percent (123.4%)</option>
                            </select>
                          </div>
                        </div>
                        
                        <div class="form-group">
                          <label for="resultUnit">Result Unit</label>
                          <div class="input-group">
                            <input type="text" class="form-control" id="resultUnit" placeholder="e.g., m, kg, s">
                            <div class="input-group-append">
                              <button class="btn btn-outline-secondary" type="button" id="browseUnitsBtn">
                                <i class="fas fa-ruler-combined"></i> Browse
                              </button>
                            </div>
                          </div>
                          <small class="form-text text-muted">Enter a unit symbol for this calculation's result</small>
                        </div>
                        
                        <div class="form-group">
                          <label for="resultPrefix">Result Prefix</label>
                          <input type="text" class="form-control" id="resultPrefix" placeholder="e.g., 'The answer is', 'Total:'">
                          <small class="form-text text-muted">Text to display before the result</small>
                        </div>
                        
                        <div class="form-group">
                          <label for="resultSuffix">Result Suffix</label>
                          <input type="text" class="form-control" id="resultSuffix" placeholder="e.g., 'approximately', 'max'">
                          <small class="form-text text-muted">Text to display after the result</small>
                        </div>
                        
                        <div class="form-group">
                          <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="storeHistory">
                            <label class="custom-control-label" for="storeHistory">Store calculation history</label>
                            <small class="form-text text-muted">Track the history of calculation results over time</small>
                          </div>
                        </div>
                        
                        <div class="form-group">
                          <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="showChart">
                            <label class="custom-control-label" for="showChart">Show history chart</label>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="card-footer">
                    <button type="button" id="saveCalculationBtn" class="btn btn-primary">Save Calculation</button>
                    <button type="button" id="cancelCalculationBtn" class="btn btn-secondary ml-2">Cancel</button>
                    <button type="button" id="deleteCalculationBtn" class="btn btn-danger float-right" style="display: none;">Delete</button>
                  </div>
                </div>
              </div>

                  

              
              <!-- Calculation execution view -->
              <div id="calculationExecution" style="display: none;">
                <div class="card">
                  <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                      <h5 id="executionTitle">Calculation Title</h5>
                      <div>
                        <button id="editCalculationBtn" class="btn btn-sm btn-outline-secondary">
                          <i class="fas fa-edit"></i> Edit
                        </button>
                        <button id="refreshCalculationBtn" class="btn btn-sm btn-outline-primary">
                          <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                        <button id="shareCalculationBtn" class="btn btn-sm btn-outline-info">
                          <i class="fas fa-share-alt"></i> Share
                        </button>
                      </div>
                    </div>
                    <p id="executionDesc" class="text-muted mb-0"></p>
                  </div>
                  <div class="card-body">
                    <div id="parametersExecutionContainer">
                      <!-- Parameter inputs will be dynamically added here -->
                      <div class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                          <span class="sr-only">Loading...</span>
                        </div>
                        <p class="mt-2">Loading parameters...</p>
                      </div>
                    </div>
                    
                    <div class="results-panel">
                      <h5>Result</h5>
                      <div id="resultContainer">
                        <div class="d-flex justify-content-between align-items-center">
                          <div class="result-display">
                            <span id="resultPrefix"></span>
                            <span class="result-value" id="resultValue">-</span>
                            <span id="resultUnitDisplay"></span>
                            <span id="resultSuffix"></span>
                          </div>
                          <div>
                            <button id="copyResultBtn" class="btn btn-sm btn-outline-secondary">
                              <i class="fas fa-copy"></i> Copy
                            </button>
                            <button id="exportResultBtn" class="btn btn-sm btn-outline-secondary">
                              <i class="fas fa-file-export"></i> Export
                            </button>
                          </div>
                        </div>
                        <div id="errorContainer" class="error-message mt-2" style="display: none;">
                          <i class="fas fa-exclamation-triangle"></i> <span id="errorMessage"></span>
                        </div>
                        <div id="calculationDetails" class="small text-muted mt-2">
                          <!-- Calculation details will be displayed here -->
                        </div>
                      </div>
                    </div>
                    
                    <!-- Advanced results for objects/arrays -->
                    <div id="advancedResults" class="mt-4" style="display: none;">
                      <h5>Detailed Results</h5>
                      <div class="table-responsive">
                        <table class="table table-sm table-bordered" id="resultsTable">
                          <thead>
                            <tr>
                              <th>Property</th>
                              <th>Value</th>
                              <th>Unit</th>
                            </tr>
                          </thead>
                          <tbody id="resultsTableBody">
                            <!-- Results will be inserted here -->
                          </tbody>
                        </table>
                      </div>
                    </div>
                    
                    <!-- Debugging information (hidden by default) -->
                    <div id="debugInfo" class="mt-4" style="display: none;">
                      <h5>Debug Information</h5>
                      <div class="card">
                        <div class="card-header">
                          <ul class="nav nav-tabs card-header-tabs" role="tablist">
                            <li class="nav-item">
                              <a class="nav-link active" id="executed-code-tab" data-toggle="tab" href="#executedCode" role="tab">Executed Code</a>
                            </li>
                            <li class="nav-item">
                              <a class="nav-link" id="parameter-values-tab" data-toggle="tab" href="#parameterValues" role="tab">Parameter Values</a>
                            </li>
                            <li class="nav-item">
                              <a class="nav-link" id="execution-log-tab" data-toggle="tab" href="#executionLog" role="tab">Execution Log</a>
                            </li>
                          </ul>
                        </div>
                        <div class="card-body">
                          <div class="tab-content">
                            <div class="tab-pane fade show active" id="executedCode" role="tabpanel">
                              <pre class="bg-light p-3 border"><code id="executedCodeContent"></code></pre>
                            </div>
                            <div class="tab-pane fade" id="parameterValues" role="tabpanel">
                              <pre class="bg-light p-3 border"><code id="parameterValuesContent"></code></pre>
                            </div>
                            <div class="tab-pane fade" id="executionLog" role="tabpanel">
                              <pre class="bg-light p-3 border"><code id="executionLogContent"></code></pre>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="card-footer text-muted">
                    <div class="d-flex justify-content-between">
                      <span>Last calculated: <span id="lastCalculated">Never</span></span>
                      <div>
                        <div class="custom-control custom-switch d-inline-block mr-3">
                          <input type="checkbox" class="custom-control-input" id="showDebugInfo">
                          <label class="custom-control-label" for="showDebugInfo">Show Debug Info</label>
                        </div>
                        <span>ID: <span id="calculationId"></span></span>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- History chart -->
                <div class="card mt-3" id="historyCard" style="display: none;">
                  <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                      <h5>Calculation History</h5>
                      <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-secondary active" id="historyDay">Day</button>
                        <button class="btn btn-outline-secondary" id="historyWeek">Week</button>
                        <button class="btn btn-outline-secondary" id="historyMonth">Month</button>
                        <button class="btn btn-outline-secondary" id="historyYear">Year</button>
                      </div>
                    </div>
                  </div>
                  <div class="card-body">
                    <canvas id="historyChart" style="height: 300px;"></canvas>
                  </div>
                  <div class="card-footer text-muted">
                    <div class="d-flex justify-content-between">
                      <span>History entries: <span id="historyCount">0</span></span>
                      <div>
                        <button id="clearHistoryBtn" class="btn btn-sm btn-outline-danger">
                          <i class="fas fa-trash"></i> Clear History
                        </button>
                        <button id="exportHistoryBtn" class="btn btn-sm btn-outline-secondary">
                          <i class="fas fa-file-export"></i> Export History
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Dependency warning alert -->
                <div class="alert alert-warning mt-3" id="dependencyWarning" style="display: none;">
                  <i class="fas fa-exclamation-triangle"></i> <strong>Warning:</strong> 
                  Some dependencies have changed since the last calculation. The result may be outdated.
                  <button id="recalculateBtn" class="btn btn-sm btn-warning ml-3">
                    <i class="fas fa-sync-alt"></i> Recalculate
                  </button>
                </div>
                
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Functions View -->
      <div class="tab-pane fade" id="functionsView" role="tabpanel">
        <div class="row">
          <div class="col-md-3 sidebar">
            <div class="mb-3">
              <button id="addFunctionBtn" class="btn btn-primary btn-block">Add New Function</button>
            </div>
            <div class="mb-3">
              <input type="text" id="functionSearch" class="form-control" placeholder="Search functions...">
            </div>
            
            <div class="card">
              <div class="card-header">
                <strong>User-Defined Functions</strong>
              </div>
              <div class="list-group list-group-flush" id="functionList">
                <!-- Function items will be dynamically added here -->
                <div class="text-center py-4 text-muted" id="noFunctionsMessage">
                  <i class="fas fa-function"></i>
                  <p>No functions created yet</p>
                </div>
              </div>
            </div>
            
            <div class="card mt-3">
              <div class="card-header">
                <strong>Built-in Functions</strong>
              </div>
              <div class="list-group list-group-flush" id="builtinFunctionList">
                <a href="#" class="list-group-item list-group-item-action" data-name="abs">
                  <span class="function-name">abs(x)</span>
                  <small class="d-block text-muted">Absolute value</small>
                </a>
                <a href="#" class="list-group-item list-group-item-action" data-name="sqrt">
                  <span class="function-name">sqrt(x)</span>
                  <small class="d-block text-muted">Square root</small>
                </a>
                <a href="#" class="list-group-item list-group-item-action" data-name="pow">
                  <span class="function-name">pow(x, y)</span>
                  <small class="d-block text-muted">x raised to power y</small>
                </a>
                <a href="#" class="list-group-item list-group-item-action" data-name="exp">
                  <span class="function-name">exp(x)</span>
                  <small class="d-block text-muted">e raised to power x</small>
                </a>
                <a href="#" class="list-group-item list-group-item-action" data-name="log">
                  <span class="function-name">log(x)</span>
                  <small class="d-block text-muted">Natural logarithm</small>
                </a>
                <a href="#" class="list-group-item list-group-item-action" data-name="log10">
                  <span class="function-name">log10(x)</span>
                  <small class="d-block text-muted">Base-10 logarithm</small>
                </a>
                
                <button class="list-group-item list-group-item-action text-primary" id="showMoreFunctionsBtn">
                  <i class="fas fa-plus-circle"></i> Show more functions...
                </button>
              </div>
            </div>
          </div>
          
          <div class="col-md-9 main-content">
            <!-- Function editor will go here -->
            <div id="functionEditor">
              <div id="emptyFunctionState">
                <div class="card">
                  <div class="card-body text-center">
                    <h5 class="card-title">No Function Selected</h5>
                    <p class="card-text">Select a function from the list or create a new one to get started.</p>
                    <button id="startNewFunctionBtn" class="btn btn-primary">
                      <i class="fas fa-plus-circle"></i> Create New Function
                    </button>
                  </div>
                </div>
                
                <div class="card mt-4">
                  <div class="card-header">
                    <h5>Function Reference</h5>
                  </div>
                  <div class="card-body">
                    <p>Functions allow you to define reusable calculations that can be shared across multiple calculations.</p>
                    
                    <h6>Creating a Function</h6>
                    <p>To create a new function:</p>
                    <ol>
                      <li>Click "Add New Function" button</li>
                      <li>Enter a unique name for your function</li>
                      <li>Define parameters that the function will accept</li>
                      <li>Write the function code using JavaScript syntax</li>
                      <li>Return the result using the <code>return</code> statement</li>
                    </ol>
                    
                    <h6>Using Functions in Calculations</h6>
                    <p>You can use functions in your calculations in several ways:</p>
                    <ul>
                      <li>In standard expressions: <code>myFunction(param1, param2)</code></li>
                      <li>In JavaScript calculations: <code>const result = myFunction(param1, param2);</code></li>
                      <li>In Python calculations: <code>result = myFunction(param1, param2)</code></li>
                    </ul>
                    
                    <h6>Example Function</h6>
                    <pre class="bg-light p-2"><code>// Calculate cylinder volume
        function cylinderVolume(radius, height) {
          // Validate inputs
          if (radius <= 0 || height <= 0) {
            throw new Error('Dimensions must be positive numbers');
          }
          
          // Calculate volume
          const volume = Math.PI * Math.pow(radius, 2) * height;
          
          // Return result
          return volume;
        }</code></pre>
                  </div>
                </div>
              </div>
              
              <div id="functionForm" style="display: none;">
                <div class="card">
                  <div class="card-header">
                    <h5>Function Editor</h5>
                  </div>
                  <div class="card-body">
                    <div class="form-group">
                      <label for="functionName">Function Name <span class="text-danger">*</span></label>
                      <input type="text" class="form-control" id="functionName" placeholder="Enter function name (e.g., calculateVolume)">
                      <small class="form-text text-muted">Use a descriptive name without spaces or special characters</small>
                    </div>
                    <div class="form-group">
                      <label for="functionDesc">Description</label>
                      <textarea class="form-control" id="functionDesc" rows="2" placeholder="Enter function description"></textarea>
                      <small class="form-text text-muted">Describe what this function does and how to use it</small>
                    </div>
                    <div class="form-group">
                      <label for="functionParams">Parameters (comma separated) <span class="text-danger">*</span></label>
                      <input type="text" class="form-control" id="functionParams" placeholder="param1, param2, ...">
                      <small class="form-text text-muted">List the parameters this function accepts</small>
                    </div>
                    <div class="form-group">
                      <label for="functionCode">Function Code <span class="text-danger">*</span></label>
                      <div id="functionCodeEditor" class="code-editor"></div>
                      <small class="form-text text-muted mt-2">
                        Write your function code using JavaScript. Access parameters using the names you defined above.
                        Return your result with the <code>return</code> statement.
                      </small>
                    </div>
                    <div class="form-group">
                      <label>Function Signature Preview</label>
                      <pre class="bg-light p-2" id="functionSignature">function myFunction(param1, param2) { ... }</pre>
                    </div>
                    <div class="form-group">
                      <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input" id="functionGlobal" checked>
                        <label class="custom-control-label" for="functionGlobal">Make available globally</label>
                        <small class="form-text text-muted">Function will be available to all calculations</small>
                      </div>
                    </div>
                    <div class="form-group">
                      <label>Tags</label>
                      <input type="text" class="form-control" id="functionTags" placeholder="comma, separated, tags">
                      <small class="form-text text-muted">Add tags to help organize and find your functions</small>
                    </div>
                  </div>
                  <div class="card-footer">
                    <button type="button" id="saveFunctionBtn" class="btn btn-primary">Save Function</button>
                    <button type="button" id="testFunctionBtn" class="btn btn-outline-secondary ml-2">
                      <i class="fas fa-vial"></i> Test Function
                    </button>
                    <button type="button" id="cancelFunctionBtn" class="btn btn-secondary ml-2">Cancel</button>
                    <button type="button" id="deleteFunctionBtn" class="btn btn-danger float-right" style="display: none;">Delete</button>
                  </div>
                </div>
                
                <div id="functionTestArea" class="card mt-3" style="display: none;">
                  <div class="card-header">
                    <h5>Function Testing</h5>
                  </div>
                  <div class="card-body">
                    <div id="testParamsContainer">
                      <!-- Test parameter inputs will be added here -->
                    </div>
                    <button type="button" id="runFunctionTestBtn" class="btn btn-primary mt-3">
                      <i class="fas fa-play"></i> Run Test
                    </button>
                    
                    <div id="functionTestResult" class="mt-3" style="display: none;">
                      <h6>Test Result</h6>
                      <div id="testResultValue" class="p-3 bg-light border rounded"></div>
                    </div>
                    
                    <div id="functionTestError" class="mt-3" style="display: none;">
                      <h6>Error</h6>
                      <div id="testErrorMessage" class="p-3 bg-danger text-white border rounded"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Function documentation modal -->
        <div class="modal fade" id="functionDocModal" tabindex="-1" role="dialog">
          <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="functionDocTitle">Function Documentation</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body" id="functionDocContent">
                <!-- Function documentation will be added here -->
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        </div>
        
      </div>
      
      <!-- Variables View -->
      <div class="tab-pane fade" id="variablesView" role="tabpanel">
        <div class="row">
          <div class="col-md-12">
            <div class="card">
              <div class="card-header">
                <h5>Variable Browser</h5>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-6">
                    <div class="input-group mb-3">
                      <input type="text" id="variableSearch" class="form-control" placeholder="Search variables...">
                      <div class="input-group-append">
                        <button class="btn btn-outline-secondary" type="button" id="clearVariableSearch">
                          <i class="fas fa-times"></i>
                        </button>
                      </div>
                    </div>
                    
                    <div class="form-group">
                      <label>Filter by Type</label>
                      <div class="btn-group btn-group-sm mb-3 variable-type-filter">
                        <button type="button" class="btn btn-outline-primary active" data-filter="all">All</button>
                        <button type="button" class="btn btn-outline-primary" data-filter="parameter">Parameters</button>
                        <button type="button" class="btn btn-outline-primary" data-filter="calculation">Calculations</button>
                        <button type="button" class="btn btn-outline-primary" data-filter="function">Functions</button>
                      </div>
                    </div>
                    
                    <div id="variableBrowser" class="border rounded p-3 bg-light" style="height: 600px; overflow-y: auto;">
                      <ul class="variable-tree variable-tree-root">
                        <!-- Variables will be dynamically added here -->
                        <li class="text-muted text-center py-3">
                          <i class="fas fa-search mb-2"></i><br>
                          Loading variables...
                        </li>
                      </ul>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="card">
                      <div class="card-header">
                        <h6>Variable Details</h6>
                      </div>
                      <div class="card-body">
                        <div id="variableDetails">
                          <p class="text-muted text-center py-4">
                            <i class="fas fa-info-circle mb-2 d-block"></i>
                            Select a variable to see details
                          </p>
                        </div>
                        
                        <div id="variableInfoContent" style="display: none;">
                          <h5 id="variableNameDisplay"></h5>
                          <div class="badge badge-info mb-2" id="variableTypeDisplay"></div>
                          
                          <div class="parameter-details" style="display: none;">
                            <table class="table table-sm">
                              <tr>
                                <th>Label</th>
                                <td id="paramLabelDisplay"></td>
                              </tr>
                              <tr>
                                <th>Data Type</th>
                                <td id="paramDataTypeDisplay"></td>
                              </tr>
                              <tr>
                                <th>Default</th>
                                <td id="paramDefaultDisplay"></td>
                              </tr>
                              <tr>
                                <th>Unit</th>
                                <td id="paramUnitDisplay"></td>
                              </tr>
                              <tr>
                                <th>Description</th>
                                <td id="paramDescDisplay"></td>
                              </tr>
                            </table>
                          </div>
                          
                          <div class="calculation-details" style="display: none;">
                            <table class="table table-sm">
                              <tr>
                                <th>Title</th>
                                <td id="calcTitleDisplay"></td>
                              </tr>
                              <tr>
                                <th>Description</th>
                                <td id="calcDescDisplay"></td>
                              </tr>
                              <tr>
                                <th>Result Type</th>
                                <td id="calcResultTypeDisplay"></td>
                              </tr>
                              <tr>
                                <th>Unit</th>
                                <td id="calcUnitDisplay"></td>
                              </tr>
                            </table>
                            
                            <div>
                              <button id="openCalcBtn" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-external-link-alt"></i> Open Calculation
                              </button>
                            </div>
                          </div>
                          
                          <div class="function-details" style="display: none;">
                            <div class="mb-3">
                              <code id="functionSignatureDisplay" class="bg-light p-2 d-block"></code>
                            </div>
                            
                            <p id="functionDescDisplay"></p>
                            
                            <h6>Parameters</h6>
                            <table class="table table-sm table-striped" id="functionParamsTable">
                              <thead>
                                <tr>
                                  <th>Name</th>
                                  <th>Description</th>
                                </tr>
                              </thead>
                              <tbody id="functionParamsBody">
                                <!-- Parameters will be added here -->
                              </tbody>
                            </table>
                            
                            <div>
                              <button id="openFuncBtn" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-external-link-alt"></i> Open Function
                              </button>
                            </div>
                          </div>
                          
                          <div class="mt-4">
                            <h6>Used In</h6>
                            <div id="usedInContainer">
                              <p class="text-muted">Scanning references...</p>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div class="card mt-3">
                      <div class="card-header">
                        <h6>Current Value</h6>
                      </div>
                      <div class="card-body">
                        <div id="variableValueContent">
                          <p class="text-muted text-center">Select a variable to see its current value</p>
                        </div>
                        
                        <div id="variableValueDisplay" style="display: none;">
                          <div class="d-flex justify-content-between align-items-center">
                            <div>
                              <span class="text-muted">Value:</span>
                              <span class="ml-2 font-weight-bold" id="currentValueDisplay">-</span>
                              <span id="valueUnitDisplay"></span>
                            </div>
                            <button id="copyValueBtn" class="btn btn-sm btn-outline-secondary">
                              <i class="fas fa-copy"></i> Copy
                            </button>
                          </div>
                          
                          <div class="small text-muted mt-2">
                            <span>Last updated: </span>
                            <span id="lastUpdatedDisplay">-</span>
                          </div>
                          
                          <div id="valueHistoryContainer" class="mt-3" style="display: none;">
                            <h6>Value History</h6>
                            <div id="valueHistoryChart" style="height: 200px;"></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="card mt-4">
              <div class="card-header">
                <h5>Dependency Graph</h5>
              </div>
              <div class="card-body">
                <div class="btn-group btn-group-sm mb-3">
                  <button class="btn btn-outline-secondary active" id="dependencyGraphAll">All</button>
                  <button class="btn btn-outline-secondary" id="dependencyGraphSelected">Selected Variable</button>
                </div>
                
                <div id="dependencyGraphContainer" style="height: 600px; border: 1px solid #dee2e6;">
                  <!-- Dependency graph will be rendered here -->
                  <div class="text-center py-5 text-muted">
                    <i class="fas fa-project-diagram fa-3x mb-3"></i>
                    <p>The dependency graph visualizes relationships between calculations, parameters, and functions.</p>
                    <p>Variables that depend on other variables will be connected with arrows.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Settings View -->
      <div class="tab-pane fade" id="settingsView" role="tabpanel">
        <div class="row">
          <div class="col-md-6">
            <!-- General Settings -->
            <div class="card mb-4">
              <div class="card-header">
                <h5>General Settings</h5>
              </div>
              <div class="card-body">
                <form id="generalSettingsForm">
                  <div class="form-group">
                    <label for="defaultDecimalPlaces">Default Decimal Places</label>
                    <input type="number" class="form-control" id="defaultDecimalPlaces" min="0" max="15" value="2">
                    <small class="form-text text-muted">Number of decimal places to display by default</small>
                  </div>
                  <div class="form-group">
                    <label for="defaultNumberFormat">Default Number Format</label>
                    <select class="form-control" id="defaultNumberFormat">
                      <option value="decimal">Decimal (1,234.56)</option>
                      <option value="scientific">Scientific (1.23e+3)</option>
                      <option value="engineering">Engineering (1.23E+3)</option>
                      <option value="percent">Percent (123.4%)</option>
                    </select>
                    <small class="form-text text-muted">Default format for number display</small>
                  </div>
                  <div class="form-group">
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="autoCalculate" checked>
                      <label class="custom-control-label" for="autoCalculate">Auto-calculate on parameter change</label>
                      <small class="form-text text-muted">Automatically update results when parameters change</small>
                    </div>
                  </div>
                  <div class="form-group">
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="storeResultsHistory" checked>
                      <label class="custom-control-label" for="storeResultsHistory">Store calculation history by default</label>
                      <small class="form-text text-muted">Save a history of calculation results</small>
                    </div>
                  </div>
                  <div class="form-group">
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="showFunctionTooltips" checked>
                      <label class="custom-control-label" for="showFunctionTooltips">Show function tooltips</label>
                      <small class="form-text text-muted">Display tooltips with function information</small>
                    </div>
                  </div>
                  <button type="submit" id="saveGeneralSettingsBtn" class="btn btn-primary">Save Settings</button>
                </form>
              </div>
            </div>
            
            <!-- OpenAI Integration -->
            <div class="card mb-4">
              <div class="card-header">
                <h5>OpenAI Integration</h5>
              </div>
              <div class="card-body">
                <form id="openaiSettingsForm">
                  <div class="form-group">
                    <label for="openaiApiKey">OpenAI API Key</label>
                    <div class="input-group">
                      <input type="password" class="form-control" id="openaiApiKey" placeholder="Enter your OpenAI API key">
                      <div class="input-group-append">
                        <button class="btn btn-outline-secondary" type="button" id="toggleApiKeyBtn">
                          <i class="fas fa-eye"></i>
                        </button>
                      </div>
                    </div>
                    <small class="form-text text-muted">Your API key is stored securely in your browser's local storage</small>
                  </div>
                  <div class="form-group">
                    <label for="openaiModel">Model</label>
                    <select class="form-control" id="openaiModel">
                      <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                      <option value="gpt-4">GPT-4</option>
                      <option value="gpt-4o">GPT-4o</option>
                    </select>
                    <small class="form-text text-muted">Select the OpenAI model to use for AI assistance</small>
                  </div>
                  <div class="form-group">
                    <label for="aiFeatures">AI Features</label>
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="aiSuggestParams" checked>
                      <label class="custom-control-label" for="aiSuggestParams">Parameter suggestions</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="aiCodeHelp" checked>
                      <label class="custom-control-label" for="aiCodeHelp">Code assistance</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="aiErrorHelp" checked>
                      <label class="custom-control-label" for="aiErrorHelp">Error analysis</label>
                    </div>
                  </div>
                  <button type="submit" id="saveApiSettingsBtn" class="btn btn-primary">Save API Settings</button>
                  <button type="button" id="testApiBtn" class="btn btn-outline-secondary ml-2">Test Connection</button>
                </form>
                
                <div id="apiTestResult" class="mt-3" style="display: none;"></div>
              </div>
            </div>
          </div>
          
          <div class="col-md-6">
            <!-- Import/Export -->
            <div class="card mb-4">
              <div class="card-header">
                <h5>Import / Export</h5>
              </div>
              <div class="card-body">
                <p>Export your calculations and functions or import from a file.</p>
                <div class="form-group">
                  <label>Export Data</label>
                  <div>
                    <button id="exportAllBtn" class="btn btn-outline-primary mr-2">Export All</button>
                    <button id="exportCalculationsBtn" class="btn btn-outline-secondary mr-2">Export Calculations</button>
                    <button id="exportFunctionsBtn" class="btn btn-outline-secondary">Export Functions</button>
                  </div>
                </div>
                <div class="form-group">
                  <label for="importFile">Import Data</label>
                  <div class="custom-file">
                    <input type="file" class="custom-file-input" id="importFile">
                    <label class="custom-file-label" for="importFile">Choose file</label>
                  </div>
                  <small class="form-text text-muted">Import from a previously exported file (.json)</small>
                </div>
                
                <div class="form-group mt-4">
                  <label>Database Management</label>
                  <div class="d-flex flex-column">
                    <button id="clearAllDataBtn" class="btn btn-danger mb-2">
                      <i class="fas fa-exclamation-triangle"></i> Clear All Data
                    </button>
                    <small class="form-text text-muted">Warning: This will permanently delete all calculations, functions, and settings</small>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Brython Settings (if enabled) -->
            <div class="card mb-4">
              <div class="card-header">
                <h5>Python Support (Brython)</h5>
              </div>
              <div class="card-body">
                <div class="form-group">
                  <div class="custom-control custom-switch">
                    <input type="checkbox" class="custom-control-input" id="enableBrython">
                    <label class="custom-control-label" for="enableBrython">Enable Python Support</label>
                  </div>
                  <small class="form-text text-muted">Enables Python syntax for custom calculations using Brython</small>
                </div>
                <div id="brythonSettings" style="display: none;">
                  <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> Enabling Python support will download additional libraries (~1MB). 
                    Page reload required after changing this setting.
                  </div>
                  <div class="form-group">
                    <label for="brythonModules">Additional Python Modules</label>
                    <input type="text" class="form-control" id="brythonModules" placeholder="math, numpy, scipy, etc.">
                    <small class="form-text text-muted">Comma-separated list of Python modules to include (limited to Brython-supported modules)</small>
                  </div>
                  <div class="form-group">
                    <label for="pythonVersion">Python Version</label>
                    <select class="form-control" id="pythonVersion">
                      <option value="3.10">Python 3.10</option>
                      <option value="3.11">Python 3.11</option>
                    </select>
                  </div>
                  <button id="saveBrythonSettingsBtn" class="btn btn-primary">Save Python Settings</button>
                </div>
              </div>
            </div>
            
            <!-- About Section -->
            <div class="card">
              <div class="card-header">
                <h5>About</h5>
              </div>
              <div class="card-body">
                <h4>Advanced Calculations System</h4>
                <p>Version 1.0</p>
                <p>A flexible system for complex calculations beyond Excel's capabilities.</p>
                <p class="mb-1">Features:</p>
                <ul>
                  <li>Complex logic and conditional statements</li>
                  <li>Iterations and loops</li>
                  <li>Custom code input</li>
                  <li>Parameter hierarchy and organization</li>
                  <li>Result visualization</li>
                  <li>AI-assisted calculation creation</li>
                </ul>
                
                <p class="mt-3 small text-muted">
                  Built with JavaScript, Math.js, Chart.js, and Bootstrap.
                  Optional Python support via Brython.
                </p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Confirmation Modal -->
        <div class="modal fade" id="confirmationModal" tabindex="-1" role="dialog">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Confirmation</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <p id="confirmationMessage">Are you sure you want to proceed?</p>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="confirmActionBtn">Confirm</button>
              </div>
            </div>
          </div>
        </div>
        
      </div>
    </div>
  </div>

  <!-- Modals -->
  <div class="modal fade" id="variableBrowserModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Variable Browser</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="input-group mb-3">
            <input type="text" class="form-control" id="modalVariableSearch" placeholder="Search variables...">
            <div class="input-group-append">
              <button class="btn btn-outline-secondary" type="button" id="modalClearVariableSearch">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
          <div id="modalVariableBrowser"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" id="insertVariableBtn">Insert Selected</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="newParameterModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add Parameter</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <!-- Parameter form fields go here -->
          <div class="form-group">
            <label for="paramName">Parameter Name <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="paramName" placeholder="Enter parameter name (e.g., radius)" required>
            <small class="form-text text-muted">Use a simple name without spaces or special characters</small>
          </div>
          <div class="form-group">
            <label for="paramLabel">Display Label <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="paramLabel" placeholder="User-friendly label (e.g., Radius)" required>
          </div>
          <div class="form-group">
            <label for="paramType">Parameter Type <span class="text-danger">*</span></label>
            <select class="form-control" id="paramType">
              <option value="number">Number</option>
              <option value="text">Text</option>
              <option value="boolean">Boolean (Yes/No)</option>
              <option value="select">Select (Dropdown)</option>
              <option value="date">Date</option>
              <option value="calculation">Calculation Reference</option>
            </select>
          </div>

                  <!-- Type-specific options -->
                  <div id="numberOptions" class="type-specific-options">
                    <div class="form-row">
                      <div class="form-group col-md-6">
                        <label for="defaultValue">Default Value</label>
                        <input type="number" class="form-control" id="defaultValue" step="any">
                      </div>
                      <div class="form-group col-md-6">
                        <label for="paramUnit">Unit</label>
                        <input type="text" class="form-control" id="paramUnit" placeholder="e.g., m, kg">
                      </div>
                    </div>
                    <div class="form-row">
                      <div class="form-group col-md-6">
                        <label for="minValue">Minimum Value</label>
                        <input type="number" class="form-control" id="minValue" step="any">
                      </div>
                      <div class="form-group col-md-6">
                        <label for="maxValue">Maximum Value</label>
                        <input type="number" class="form-control" id="maxValue" step="any">
                      </div>
                    </div>
                    <div class="form-row">
                      <div class="form-group col-md-6">
                        <label for="stepValue">Step Value</label>
                        <input type="number" class="form-control" id="stepValue" min="0" step="any">
                      </div>
                      <div class="form-group col-md-6">
                        <label for="decimalDisplay">Decimal Places</label>
                        <input type="number" class="form-control" id="decimalDisplay" min="0" max="15" value="2">
                      </div>
                    </div>
                  </div>
                  
                  <div id="textOptions" class="type-specific-options" style="display: none;">
                    <div class="form-group">
                      <label for="textDefaultValue">Default Value</label>
                      <input type="text" class="form-control" id="textDefaultValue">
                    </div>
                    <div class="form-group">
                      <label for="placeholder">Placeholder</label>
                      <input type="text" class="form-control" id="placeholder">
                    </div>
                    <div class="form-group">
                      <label for="textPattern">Pattern (RegEx)</label>
                      <input type="text" class="form-control" id="textPattern" placeholder="e.g., [A-Za-z0-9]+">
                      <small class="form-text text-muted">Optional: validate input with a regular expression</small>
                    </div>
                  </div>
                  
                  <div id="booleanOptions" class="type-specific-options" style="display: none;">
                    <div class="form-group">
                      <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input" id="boolDefaultValue">
                        <label class="custom-control-label" for="boolDefaultValue">Default Value (checked = Yes/True)</label>
                      </div>
                    </div>
                    <div class="form-row">
                      <div class="form-group col-md-6">
                        <label for="trueLabel">True Label</label>
                        <input type="text" class="form-control" id="trueLabel" placeholder="Yes" value="Yes">
                      </div>
                      <div class="form-group col-md-6">
                        <label for="falseLabel">False Label</label>
                        <input type="text" class="form-control" id="falseLabel" placeholder="No" value="No">
                      </div>
                    </div>
                  </div>
                  
                  <div id="selectOptions" class="type-specific-options" style="display: none;">
                    <div class="form-group">
                      <label for="selectDefaultValue">Default Selection</label>
                      <input type="text" class="form-control" id="selectDefaultValue">
                      <small class="form-text text-muted">Must match one of the option values below</small>
                    </div>
                    
                    <div class="form-group">
                      <label>Options</label>
                      <div id="selectOptionsContainer">
                        <div class="input-group mb-2 select-option">
                          <input type="text" class="form-control option-value" placeholder="Value">
                          <input type="text" class="form-control option-label" placeholder="Label">
                          <div class="input-group-append">
                            <button class="btn btn-outline-danger remove-option-btn" type="button">
                              <i class="fas fa-times"></i>
                            </button>
                          </div>
                        </div>
                      </div>
                      <button type="button" class="btn btn-sm btn-outline-secondary" id="addOptionBtn">
                        <i class="fas fa-plus"></i> Add Option
                      </button>
                    </div>
                  </div>
                  
                  <div id="dateOptions" class="type-specific-options" style="display: none;">
                    <div class="form-group">
                      <label for="dateDefaultValue">Default Date</label>
                      <input type="date" class="form-control" id="dateDefaultValue">
                    </div>
                    <div class="form-row">
                      <div class="form-group col-md-6">
                        <label for="minDate">Minimum Date</label>
                        <input type="date" class="form-control" id="minDate">
                      </div>
                      <div class="form-group col-md-6">
                        <label for="maxDate">Maximum Date</label>
                        <input type="date" class="form-control" id="maxDate">
                      </div>
                    </div>
                  </div>
                  
                  <div id="calculationOptions" class="type-specific-options" style="display: none;">
                    <div class="form-group">
                      <label for="calcReference">Referenced Calculation</label>
                      <select class="form-control" id="calcReference">
                        <option value="">Select a calculation</option>
                        <!-- Options will be populated dynamically -->
                      </select>
                      <small class="form-text text-muted">Use the result of another calculation as input</small>
                    </div>
                    <div class="form-group">
                      <label for="resultProperty">Result Property (for multi-valued results)</label>
                      <input type="text" class="form-control" id="resultProperty" placeholder="Leave empty for single values">
                      <small class="form-text text-muted">If the referenced calculation returns an object, specify which property to use</small>
                    </div>
                  </div>
                  
                  <!-- Common options for all parameter types -->
                  <div class="form-group mt-3">
                    <label for="paramDescription">Description</label>
                    <textarea class="form-control" id="paramDescription" rows="2" placeholder="Describe what this parameter is used for"></textarea>
                  </div>
                  
                  <div class="form-group">
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="paramRequired">
                      <label class="custom-control-label" for="paramRequired">Required</label>
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="paramAdvanced">
                      <label class="custom-control-label" for="paramAdvanced">Advanced Parameter</label>
                      <small class="form-text text-muted">Advanced parameters are shown in a collapsed section</small>
                    </div>
                  </div>
                </div>
              </div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="saveParameterBtn">Add Parameter</button>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript Dependencies -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
  
  <!-- Brython (optional, loaded dynamically based on settings) -->
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.11.0/brython.min.js"></script> -->
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.11.0/brython_stdlib.min.js"></script> -->
  
  <!-- Application JavaScript -->
  <script src="calculations-db.js"></script>
  <script src="calculations-engine.js"></script>
  <script src="calculations-ui.js"></script>
  <script src="calculation-functions.js"></script>
</body>
</html>
